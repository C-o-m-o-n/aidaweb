<!DOCTYPE html>
<html>
<head>
    <title>Basic Info List</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="basic-info-list">
        <h1>Basic Information List</h1>
        <ul>
            <li>Username: </li>
            <li><img id='pfp'></li>

        <div class="logout-btn">
                <a href="/logout">Logout</a>    
        </div>
        <script>
            // Function to get token from URL or local storage
            function getToken() {
                const urlParams = new URLSearchParams(window.location.hash.substr(1));
                const token = urlParams.get('access_token');
                if (token) {
                    localStorage.setItem('token', token); // Save token to local storage
                    return token;
                } else {
                    return localStorage.getItem('token'); // Try to read token from local storage
                }
            }

            const token = getToken(); // Get token

            if (token) {
                fetch('https://discord.com/api/users/@me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.querySelector('li').textContent = `Username: ${data.username}#${data.discriminator}`;
                    document.getElementById('pfp').src = `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png`;

                    // Check if user is on guild 1079761115636043926
                    fetch('https://discord.com/api/users/@me/guilds', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    })
                    .then(response => response.json())
                    .then(guilds => {
                        const guildIds = guilds.map(guild => guild.id);
                        if (guildIds.includes('1079761115636043926')) {
                            console.log('User is on guild 1079761115636043926');
                        } else {
                            console.log('User is not on guild 1079761115636043926');
                        }
                    })
                    .catch(error => console.error('Error:', error));
                })
                .catch(error => console.error('Error:', error));
            } else {
                console.log('No token found.');
            }
        </script>
</body>
</html>
